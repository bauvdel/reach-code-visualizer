<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REACH Code Visualizer</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- vis.js Network -->
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header / Search Bar -->
        <header class="app-header">
            <div class="header-brand">
                <i class="bi bi-diagram-3"></i>
                <span>REACH Code Visualizer</span>
            </div>

            <div class="search-container">
                <div class="search-wrapper">
                    <i class="bi bi-search search-icon"></i>
                    <input type="text"
                           id="search-input"
                           class="search-input"
                           placeholder="Search nodes or query: 'path from X to Y', 'what calls X?'">
                    <button id="search-btn" class="search-btn">
                        <i class="bi bi-arrow-right-circle"></i>
                    </button>
                </div>
                <div id="search-results" class="search-results"></div>
            </div>

            <div class="header-filters">
                <select id="filter-type" class="filter-select">
                    <option value="">All Types</option>
                    <option value="FUNCTION">Functions</option>
                    <option value="VARIABLE">Variables</option>
                    <option value="SIGNAL">Signals</option>
                    <option value="CLASS">Classes</option>
                    <option value="SCENE">Scenes</option>
                </select>

                <select id="filter-language" class="filter-select">
                    <option value="">All Languages</option>
                    <option value="gdscript">GDScript</option>
                    <option value="tscn">TSCN</option>
                </select>

                <button id="refresh-btn" class="action-btn" title="Refresh Graph">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>

                <button id="fit-btn" class="action-btn" title="Fit to Screen">
                    <i class="bi bi-fullscreen"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Graph Container -->
            <div class="graph-panel">
                <div id="graph-container"></div>

                <!-- Graph Controls Overlay -->
                <div class="graph-controls">
                    <button id="zoom-in" class="control-btn" title="Zoom In">
                        <i class="bi bi-zoom-in"></i>
                    </button>
                    <button id="zoom-out" class="control-btn" title="Zoom Out">
                        <i class="bi bi-zoom-out"></i>
                    </button>
                    <button id="center-btn" class="control-btn" title="Center View">
                        <i class="bi bi-bullseye"></i>
                    </button>
                </div>

                <!-- Loading Overlay -->
                <div id="loading-overlay" class="loading-overlay">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div class="loading-text">Loading graph...</div>
                </div>
            </div>

            <!-- Inspector Panel -->
            <div id="inspector-panel" class="inspector-panel">
                <div class="inspector-header">
                    <h3>Node Inspector</h3>
                    <button id="close-inspector" class="close-btn">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>

                <div id="inspector-content" class="inspector-content">
                    <div class="inspector-placeholder">
                        <i class="bi bi-cursor-fill"></i>
                        <p>Click a node to inspect</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="status-nodes">
                    <i class="bi bi-circle-fill text-primary"></i>
                    <span class="status-value">0</span> nodes
                </span>
                <span id="status-edges">
                    <i class="bi bi-arrow-right"></i>
                    <span class="status-value">0</span> edges
                </span>
                <span id="status-visible">
                    <i class="bi bi-eye"></i>
                    <span class="status-value">0</span> visible
                </span>
            </div>

            <div class="status-center">
                <span id="status-message"></span>
            </div>

            <div class="status-right">
                <span id="status-connection" class="status-connected">
                    <i class="bi bi-wifi"></i> Connected
                </span>
                <span id="status-updated">
                    <i class="bi bi-clock"></i>
                    Last updated: <span class="status-value">--</span>
                </span>
            </div>
        </footer>
    </div>

    <!-- Query Results Modal -->
    <div id="query-modal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Query Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="query-results"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="/js/api-client.js"></script>
    <script src="/js/graph-renderer.js"></script>
    <script src="/js/node-inspector.js"></script>
    <script src="/js/query-interface.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
